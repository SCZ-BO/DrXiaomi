<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Factura Web - Santa Cruz, Bolivia</title>
    
    <!-- Incluir jsPDF versi√≥n estable -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-dark: #121212;
            --secondary-dark: #1e1e1e;
            --tertiary-dark: #2d2d2d;
            --accent-color: #4a9eff;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --border-color: #404040;
            --success-color: #4caf50;
            --whatsapp-color: #25D366;
            --cash-color: #00c853;
            --qr-color: #2196f3;
            --highlight-color: #ff9800;
            --modern-bg: #1a1a2e;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--primary-dark);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        header {
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 30px;
        }

        .logo h1 {
            color: var(--accent-color);
            font-size: 28px;
            margin-bottom: 5px;
        }

        .logo span {
            color: var(--text-secondary);
            font-size: 16px;
            display: block;
        }

        .theme-toggle {
            background: var(--tertiary-dark);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 15px;
            float: right;
        }

        h2 {
            color: var(--accent-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .form-section {
            background-color: var(--secondary-dark);
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .required::after {
            content: " *";
            color: #ff5252;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            background-color: var(--tertiary-dark);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 16px;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        /* Opciones de pago - Destacado */
        .payment-group {
            margin: 30px 0;
            padding: 20px;
            background: rgba(74, 158, 255, 0.05);
            border-radius: 8px;
            border-left: 4px solid var(--accent-color);
        }

        .payment-group label {
            font-size: 16px;
            color: var(--accent-color);
            font-weight: 600;
        }

        .payment-options {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .payment-option {
            flex: 1;
            padding: 15px;
            background: var(--tertiary-dark);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .payment-option:hover {
            background: var(--border-color);
        }

        .payment-option.selected {
            border-color: var(--accent-color);
            background: rgba(74, 158, 255, 0.1);
        }

        .payment-option.cash {
            border-color: var(--cash-color);
        }

        .payment-option.cash.selected {
            background: rgba(0, 200, 83, 0.1);
        }

        .payment-option.qr {
            border-color: var(--qr-color);
        }

        .payment-option.qr.selected {
            background: rgba(33, 150, 243, 0.1);
        }

        .payment-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .payment-option.cash .payment-icon {
            color: var(--cash-color);
        }

        .payment-option.qr .payment-icon {
            color: var(--qr-color);
        }

        /* QR Code display con imagen fija */
        .qr-container {
            margin-top: 15px;
            text-align: center;
            display: none;
        }

        .qr-code {
            width: 200px;
            height: 200px;
            background: #fff;
            margin: 10px auto;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .qr-code img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Tabla de art√≠culos - SIN CANTIDAD */
        .items-container {
            margin: 20px 0;
        }

        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background: var(--modern-bg);
            border-radius: 12px;
            overflow: hidden;
        }

        .items-table th {
            background-color: #2d2d4a;
            padding: 15px;
            text-align: left;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .items-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .items-table tr:last-child td {
            border-bottom: none;
        }

        .items-table input {
            background-color: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-primary);
            font-size: 15px;
            transition: all 0.3s ease;
        }

        .items-table input:focus {
            border-color: var(--accent-color);
            background-color: rgba(74, 158, 255, 0.1);
        }

        .btn-add-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            width: 100%;
            font-size: 15px;
            transition: transform 0.3s ease;
        }

        .btn-add-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        /* Garant√≠a - Menos llamativo y abajo */
        .warranty-group {
            margin-top: 30px;
            padding: 15px;
            background: var(--tertiary-dark);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .warranty-group label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Vista previa - MODERNA */
        .preview-section {
            background-color: var(--secondary-dark);
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .invoice-preview {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            padding: 30px;
            margin-top: 20px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            font-family: 'Inter', sans-serif;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30px;
            padding-bottom: 25px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .preview-title {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(135deg, #4a9eff 0%, #6cb1ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .preview-company {
            text-align: right;
        }

        .company-name {
            font-size: 18px;
            font-weight: 700;
            color: #4a9eff;
            margin-bottom: 5px;
        }

        .company-info {
            font-size: 12px;
            color: rgba(255,255,255,0.6);
        }

        /* Fecha y Hora autom√°tica */
        .preview-date-time {
            margin-bottom: 25px;
            padding: 10px 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            text-align: center;
            color: rgba(255,255,255,0.7);
            font-size: 14px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* Cliente - Destacado */
        .preview-client {
            background: linear-gradient(135deg, rgba(74, 158, 255, 0.1) 0%, rgba(108, 177, 255, 0.1) 100%);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 1px solid rgba(74, 158, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .preview-client::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, #4a9eff, #6cb1ff);
        }

        .client-title {
            font-size: 12px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .client-name {
            font-size: 24px;
            font-weight: 700;
            color: white;
            margin-bottom: 8px;
        }

        .client-phone {
            color: rgba(255,255,255,0.8);
            font-size: 16px;
            font-weight: 500;
        }

        /* Detalles de venta - MODERNO EN MEDIO */
        .sale-details {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin: 25px 0;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .sale-details-title {
            font-size: 18px;
            font-weight: 600;
            color: white;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sale-details-title::before {
            content: 'üõí';
            font-size: 20px;
        }

        .preview-items {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .sale-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            border-left: 4px solid var(--accent-color);
        }

        .item-info {
            flex: 1;
        }

        .item-desc {
            font-weight: 600;
            color: white;
            margin-bottom: 5px;
        }

        .item-total-preview {
            font-size: 18px;
            font-weight: 700;
            color: var(--accent-color);
        }

        /* Monto destacado */
        .amount-highlight {
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.2) 0%, rgba(255, 152, 0, 0.1) 100%);
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            text-align: center;
            border: 2px solid rgba(255, 152, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .amount-highlight::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(to right, #ff9800, #ffb74d);
        }

        .amount-label {
            font-size: 16px;
            color: rgba(255,255,255,0.8);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .amount-value {
            font-size: 42px;
            font-weight: 800;
            color: white;
            text-shadow: 0 2px 10px rgba(255, 152, 0, 0.3);
        }

        /* M√©todo de pago destacado */
        .payment-info {
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.2) 0%, rgba(33, 150, 243, 0.1) 100%);
            padding: 20px;
            border-radius: 12px;
            margin: 25px 0;
            border: 1px solid rgba(33, 150, 243, 0.3);
        }

        .payment-method {
            font-size: 20px;
            font-weight: 700;
            color: white;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .payment-method::before {
            content: 'üí≥';
            font-size: 24px;
        }

        .payment-details {
            color: rgba(255,255,255,0.8);
            font-size: 16px;
        }

        /* QR en vista previa */
        .preview-qr {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .preview-qr-code {
            width: 180px;
            height: 180px;
            background: #fff;
            margin: 10px auto;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .preview-qr-code img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Garant√≠a - Menos llamativo y abajo */
        .warranty-info {
            margin-top: 25px;
            padding: 15px;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            color: rgba(255,255,255,0.7);
            font-size: 14px;
            border-left: 3px solid rgba(255,255,255,0.2);
        }

        .warranty-text {
            font-style: italic;
        }

        /* Notas */
        .preview-notes {
            margin-top: 25px;
            padding: 20px;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .notes-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: rgba(255,255,255,0.9);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notes-title::before {
            content: 'üìù';
        }

        .notes-content {
            color: rgba(255,255,255,0.7);
            line-height: 1.5;
        }

        /* Botones */
        .actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn-generate {
            background: linear-gradient(135deg, #00c853 0%, #4caf50 100%);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            flex: 2;
            font-size: 16px;
            transition: transform 0.3s ease;
        }

        .btn-whatsapp {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            flex: 1;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: transform 0.3s ease;
        }

        .btn-reset {
            background: var(--tertiary-dark);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            flex: 1;
            font-size: 16px;
            transition: transform 0.3s ease;
        }

        .btn-generate:hover, .btn-reset:hover, .btn-whatsapp:hover {
            transform: translateY(-2px);
        }

        .btn-whatsapp:disabled {
            background: #666;
            cursor: not-allowed;
            opacity: 0.5;
            transform: none;
        }

        /* Estado de generaci√≥n de PDF */
        .pdf-status {
            margin-top: 10px;
            padding: 10px;
            background: rgba(0, 200, 83, 0.1);
            border-radius: 4px;
            color: var(--success-color);
            display: none;
        }

        footer {
            margin-top: 40px;
            text-align: center;
            color: var(--text-secondary);
            font-size: 14px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .row {
                grid-template-columns: 1fr;
            }
            
            .payment-options {
                flex-direction: column;
            }
            
            .actions {
                flex-direction: column;
            }
            
            .amount-value {
                font-size: 32px;
            }
            
            .sale-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .item-total-preview {
                align-self: flex-end;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <h1>IMPORT SCZ</h1>
                <span>TECNOLOGIA QUE SIMPLIFICA - SANTA CRUZ BOLIVIA&nbsp; </span>
            </div>
            <button class="theme-toggle" id="themeToggle">Modo Claro</button>
            <div style="clear: both;"></div>
        </header>

        <section class="form-section">
            <h2>[Tema] [Generar NOTA]</h2>
            
            <form id="invoiceForm">
                <!-- Nombre y Tel√©fono del Cliente - Destacado -->
                <div class="row">
                    <div class="form-group">
                        <label for="clientName" class="required">Nombre del Cliente</label>
                        <input type="text" id="clientName" placeholder="Ingrese nombre del cliente" required>
                    </div>
                    <div class="form-group">
                        <label for="clientPhone" class="required">Tel√©fono del Cliente</label>
                        <input type="tel" id="clientPhone" placeholder="Ej: 77712345" required pattern="[0-9]{8,12}">
                        <small style="color: var(--text-secondary); margin-top: 5px; display: block;">
                            Para enviar la factura por WhatsApp
                        </small>
                    </div>
                </div>

                <!-- M√©todo de Pago - Destacado -->
                <div class="payment-group">
                    <label>Tipo de Pago</label>
                    <div class="payment-options">
                        <div class="payment-option cash" data-payment="efectivo">
                            <div class="payment-icon">üíµ</div>
                            <div>Efectivo</div>
                        </div>
                        <div class="payment-option qr" data-payment="qr">
                            <div class="payment-icon">üì±</div>
                            <div>QR/Pago M√≥vil</div>
                        </div>
                    </div>
                    <input type="hidden" id="paymentMethod" value="efectivo">
                    
                    <!-- QR Code container con imagen fija -->
                    <div class="qr-container" id="qrContainer">
                        <div class="qr-code">
                            <!-- Coloca aqu√≠ tu imagen qr.jpg -->
                            <img src="qr.jpg" alt="C√≥digo QR para pagos" 
                                 onerror="this.style.display='none'; this.parentElement.innerHTML='[QR CODE]'">
                        </div>
                        <small>Escanea este c√≥digo para pagar</small>
                    </div>
                </div>

                <!-- Art√≠culos/Servicios - SIN CANTIDAD -->
                <div class="form-group items-container">
                    <label>Art√≠culos/Servicios</label>
                    <table class="items-table">
                        <thead>
                            <tr>
                                <th>Descripci√≥n</th>
                                <th width="200">Total</th>
                            </tr>
                        </thead>
                        <tbody id="itemsBody">
                            <tr>
                                <td><input type="text" class="item-desc" placeholder="Descripci√≥n del art√≠culo"></td>
                                <td><input type="number" class="item-total-input" placeholder="0.00" step="0.01"></td>
                            </tr>
                        </tbody>
                    </table>
                    <button type="button" class="btn-add-item" id="addItem">+ Agregar Art√≠culo</button>
                </div>

                <!-- Garant√≠a - Menos llamativo y abajo -->
                <div class="warranty-group">
                    <label for="warrantyPeriod">Tiempo de Garant√≠a (opcional)</label>
                    <select id="warrantyPeriod">
                        <option value="0">Sin garant√≠a</option>
                        <option value="30" selected>30 d√≠as</option>
                        <option value="60">60 d√≠as</option>
                        <option value="90">90 d√≠as</option>
                        <option value="180">6 meses</option>
                        <option value="365">1 a√±o</option>
                        <option value="custom">Personalizado</option>
                    </select>
                    <div id="customWarranty" style="display: none; margin-top: 10px;">
                        <input type="number" id="customWarrantyDays" placeholder="N√∫mero de d√≠as" min="1" style="width: 100%;">
                    </div>
                </div>

                <div class="form-group">
                    <label for="notes">Notas Adicionales</label>
                    <textarea id="notes" rows="3" placeholder="Notas o informaci√≥n adicional..."></textarea>
                </div>
            </form>
        </section>

        <section class="preview-section">
          <h2>Vista Previa de la Factura</h2>
            <div class="invoice-preview" id="invoicePreview">
                <!-- Encabezado -->
                <div class="preview-header">
                    <div>
                        <div class="preview-title">IMPORT SCZ&nbsp;</div>
                        <div style="margin-top: 10px; color: rgba(255,255,255,0.6); font-size: 14px;">
                            Dir: Centro Comrcial Ca√±oto #k1<br>
                          Telefono: 75589308 <br>
                            Santa Cruz, Bolivia
                        </div>
                    </div>
                    <div class="preview-company">
                        <div class="company-name">NOTA DE ENTREGA</div>
                        <div class="company-info">
                            Comprobante de Garantia<br>
                            Santa Cruz, Bolivia<br>
                          
                        </div>
                    </div>
                </div>

                <!-- Fecha y Hora AUTOM√ÅTICA -->
                <div class="preview-date-time">
                    <span id="previewDate"></span> | 
                    <span id="previewTime"></span>
                </div>

                <!-- Cliente - DESTACADO -->
                <div class="preview-client">
                    <div class="client-title">CLIENTE</div>
                    <div class="client-name" id="previewClientName">Nombre del Cliente</div>
                    <div class="client-phone" id="previewClientPhone">Tel: 77712345</div>
                </div>

                <!-- Detalles de Venta - MODERNO EN MEDIO -->
                <div class="sale-details">
                    <div class="sale-details-title">Detalles de la Venta</div>
                    <div class="preview-items" id="previewItems">
                        <div class="sale-item">
                            <div class="item-info">
                                <div class="item-desc">Art√≠culo de ejemplo</div>
                            </div>
                            <div class="item-total-preview">100.00 Bs.</div>
                        </div>
                    </div>
                </div>

                <!-- Monto TOTAL DESTACADO -->
                <div class="amount-highlight">
                    <div class="amount-label">TOTAL A PAGAR</div>
                    <div class="amount-value" id="previewTotal">100.00 Bs.</div>
                </div>

                <!-- M√©todo de Pago - DESTACADO -->
                <div class="payment-info">
                    <div class="payment-method" id="previewPaymentMethod">
                        M√©todo de Pago: Efectivo
                    </div>
                    <div class="payment-details" id="previewPaymentDetails">
                        Pago realizado en efectivo al momento de la entrega
                    </div>
                </div>

                <!-- QR Code (solo si es pago QR) -->
                <div class="preview-qr" id="previewQrSection" style="display: none;">
                    <strong>PAGO POR QR</strong>
                    <div class="preview-qr-code">
                        <!-- Misma imagen qr.jpg -->
                        <img src="qr.jpg" alt="C√≥digo QR para pagos"
                             onerror="this.style.display='none'; this.parentElement.innerHTML='[QR CODE]'">
                    </div>
                    <small>Escanea para realizar el pago</small>
                </div>

                <!-- Garant√≠a - MENOS LLAMATIVO Y ABAJO -->
                <div class="warranty-info" id="warrantyPreview">
                    <div class="warranty-text">
                        <strong>Garant√≠a:</strong> Este producto cuenta con garant√≠a de 30 d√≠as contra defectos de fabricaci√≥n. No cubre equipos golpeados o h√∫medos.
                  </div>
                </div>

                <!-- Notas -->
                <div class="preview-notes">
                    <div class="notes-title">NOTAS ADICIONALES</div>
                    <div class="notes-content" id="previewNotes">Sin notas adicionales</div>
                </div>
            </div>

            <!-- Estado de generaci√≥n de PDF -->
            <div class="pdf-status" id="pdfStatus"></div>

            <div class="actions">
                <button type="button" class="btn-generate" id="generateInvoice">
                    <span id="pdfIcon">üìÑ</span> Generar Factura PDF
                </button>
                <button type="button" class="btn-whatsapp" id="sendWhatsApp" disabled>
                    <span style="font-size: 20px;">üì±</span> Enviar por WhatsApp
                </button>
                <button type="button" class="btn-reset" id="resetForm">Restablecer</button>
            </div>
        </section>

        <footer>
            <p>¬© 2024 NOTA Web - Sistema r√°pido de facturaci√≥n. Santa Cruz, Bolivia. Todos los derechos reservados.</p>
        </footer>
    </div>

    <script>
        // Funci√≥n para verificar si jsPDF est√° cargado
        function checkJSPDF() {
            if (typeof window.jspdf === 'undefined') {
                console.error('jsPDF no est√° cargado');
                alert('Error: jsPDF no se carg√≥ correctamente. Verifica tu conexi√≥n a internet.');
                return false;
            }
            return true;
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Fecha y hora actual autom√°tica
            updateDateTime();
            
            // Actualizar fecha y hora cada minuto
            setInterval(updateDateTime, 60000);
            
            // Toggle de tema claro/oscuro
            const themeToggle = document.getElementById('themeToggle');
            themeToggle.addEventListener('click', function() {
                document.body.classList.toggle('light-theme');
                
                if (document.body.classList.contains('light-theme')) {
                    themeToggle.textContent = 'Modo Oscuro';
                    document.documentElement.style.setProperty('--primary-dark', '#f5f5f5');
                    document.documentElement.style.setProperty('--secondary-dark', '#ffffff');
                    document.documentElement.style.setProperty('--tertiary-dark', '#e0e0e0');
                    document.documentElement.style.setProperty('--text-primary', '#333333');
                    document.documentElement.style.setProperty('--text-secondary', '#666666');
                    document.documentElement.style.setProperty('--border-color', '#cccccc');
                    document.documentElement.style.setProperty('--modern-bg', '#f0f2f5');
                } else {
                    themeToggle.textContent = 'Modo Claro';
                    document.documentElement.style.setProperty('--primary-dark', '#121212');
                    document.documentElement.style.setProperty('--secondary-dark', '#1e1e1e');
                    document.documentElement.style.setProperty('--tertiary-dark', '#2d2d2d');
                    document.documentElement.style.setProperty('--text-primary', '#e0e0e0');
                    document.documentElement.style.setProperty('--text-secondary', '#a0a0a0');
                    document.documentElement.style.setProperty('--border-color', '#404040');
                    document.documentElement.style.setProperty('--modern-bg', '#1a1a2e');
                }
            });
            
            // Selecci√≥n de m√©todo de pago
            const paymentOptions = document.querySelectorAll('.payment-option');
            const paymentMethodInput = document.getElementById('paymentMethod');
            const qrContainer = document.getElementById('qrContainer');
            
            paymentOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Remover selecci√≥n previa
                    paymentOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // Seleccionar actual
                    this.classList.add('selected');
                    
                    // Actualizar valor
                    const method = this.getAttribute('data-payment');
                    paymentMethodInput.value = method;
                    
                    // Mostrar/ocultar QR
                    if (method === 'qr') {
                        qrContainer.style.display = 'block';
                    } else {
                        qrContainer.style.display = 'none';
                    }
                    
                    // Actualizar vista previa
                    updatePreview();
                });
            });
            
            // Seleccionar efectivo por defecto
            document.querySelector('.payment-option.cash').classList.add('selected');
            
            // Manejar garant√≠a personalizada
            const warrantySelect = document.getElementById('warrantyPeriod');
            const customWarrantyDiv = document.getElementById('customWarranty');
            const customWarrantyInput = document.getElementById('customWarrantyDays');
            
            warrantySelect.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customWarrantyDiv.style.display = 'block';
                    customWarrantyInput.required = true;
                } else {
                    customWarrantyDiv.style.display = 'none';
                    customWarrantyInput.required = false;
                }
                updatePreview();
            });
            
            customWarrantyInput.addEventListener('input', updatePreview);
            
            // Agregar nuevo art√≠culo
            const addItemBtn = document.getElementById('addItem');
            const itemsBody = document.getElementById('itemsBody');
            
            addItemBtn.addEventListener('click', function() {
                const newRow = document.createElement('tr');
                newRow.innerHTML = `
                    <td><input type="text" class="item-desc" placeholder="Descripci√≥n del art√≠culo"></td>
                    <td><input type="number" class="item-total-input" placeholder="0.00" step="0.01"></td>
                `;
                itemsBody.appendChild(newRow);
                
                // Agregar event listeners a los nuevos inputs
                const inputs = newRow.querySelectorAll('input');
                inputs.forEach(input => {
                    input.addEventListener('input', updatePreview);
                });
            });
            
            // Actualizar fecha y hora
            function updateDateTime() {
                const now = new Date();
                const dateStr = formatDate(now);
                const timeStr = formatTime(now);
                
                document.getElementById('previewDate').textContent = dateStr;
                document.getElementById('previewTime').textContent = timeStr;
            }
            
            // Obtener d√≠as de garant√≠a
            function getWarrantyDays() {
                const warrantySelect = document.getElementById('warrantyPeriod');
                const warrantyValue = warrantySelect.value;
                
                if (warrantyValue === 'custom') {
                    return parseInt(document.getElementById('customWarrantyDays').value) || 0;
                } else {
                    return parseInt(warrantyValue) || 0;
                }
            }
            
            // Formatear fecha de Date a DD/MM/YYYY
            function formatDate(date) {
                const day = String(date.getDate()).padStart(2, '0');
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const year = date.getFullYear();
                return `${day}/${month}/${year}`;
            }
            
            // Formatear hora de Date a HH:MM AM/PM
            function formatTime(date) {
                const hours = date.getHours();
                const minutes = String(date.getMinutes()).padStart(2, '0');
                const ampm = hours >= 12 ? 'PM' : 'AM';
                const hour12 = hours % 12 || 12;
                return `${hour12}:${minutes} ${ampm}`;
            }
            
            // Funci√≥n SIMPLIFICADA para generar PDF
            function generatePDF() {
                if (!checkJSPDF()) return;
                
                try {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    
                    // Mostrar estado
                    const pdfStatus = document.getElementById('pdfStatus');
                    pdfStatus.style.display = 'block';
                    pdfStatus.textContent = 'üîÑ Generando PDF...';
                    pdfStatus.style.background = 'rgba(255, 152, 0, 0.1)';
                    pdfStatus.style.color = '#ff9800';
                    
                    // Datos de la factura
                    const clientName = document.getElementById('clientName').value || 'Cliente';
                    const clientPhone = document.getElementById('clientPhone').value || 'No especificado';
                    const notes = document.getElementById('notes').value || 'Sin notas adicionales';
                    const date = document.getElementById('previewDate').textContent;
                    const time = document.getElementById('previewTime').textContent;
                    const paymentMethod = paymentMethodInput.value === 'efectivo' ? 'Efectivo' : 'QR/Pago M√≥vil';
                    const total = document.getElementById('previewTotal').textContent;
                    
                    let yPos = 20;
                    
                    // Encabezado
                    doc.setFontSize(24);
                    doc.setFont(undefined, 'bold');
                    doc.text('IMPORT SCZ', 20, yPos);
                    yPos += 10;
                    
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    doc.text('Tecnolog√≠a que simplifica ‚Ä¢ Santa Cruz, Bolivia', 20, yPos);
                    yPos += 7;
                    
                    doc.setFontSize(9);
                    doc.text(`Fecha: ${date} ‚Ä¢ Hora: ${time}`, 20, yPos);
                    yPos += 10;
                    
                    // T√≠tulo
                    doc.setFontSize(18);
                    doc.setFont(undefined, 'bold');
                    doc.text('NOTA DE ENTREGA', 20, yPos);
                    yPos += 15;
                    
                    // Cliente
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    doc.text('CLIENTE:', 20, yPos);
                    yPos += 7;
                    
                    doc.setFontSize(14);
                    doc.setFont(undefined, 'bold');
                    doc.text(clientName, 20, yPos);
                    yPos += 7;
                    
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    doc.text(`Tel√©fono: ${clientPhone}`, 20, yPos);
                    yPos += 15;
                    
                    // L√≠nea
                    doc.line(20, yPos, 190, yPos);
                    yPos += 10;
                    
                    // Art√≠culos
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'bold');
                    doc.text('DETALLES DE LA VENTA', 20, yPos);
                    yPos += 8;
                    
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    doc.text('Descripci√≥n', 20, yPos);
                    doc.text('Total Bs.', 160, yPos);
                    yPos += 5;
                    
                    doc.line(20, yPos, 190, yPos);
                    yPos += 10;
                    
                    let totalAmount = 0;
                    const itemRows = document.querySelectorAll('#itemsBody tr');
                    itemRows.forEach(row => {
                        const descInput = row.querySelector('.item-desc');
                        const totalInput = row.querySelector('.item-total-input');
                        
                        const desc = descInput.value || 'Art√≠culo sin descripci√≥n';
                        const itemTotal = parseFloat(totalInput.value) || 0;
                        
                        if (desc || itemTotal > 0) {
                            if (yPos > 250) {
                                doc.addPage();
                                yPos = 20;
                            }
                            
                            // Descripci√≥n (simplificada - sin wrap de texto complejo)
                            const shortDesc = desc.length > 50 ? desc.substring(0, 47) + '...' : desc;
                            doc.text(shortDesc, 20, yPos);
                            doc.text(itemTotal.toFixed(2), 160, yPos);
                            yPos += 10;
                            
                            totalAmount += itemTotal;
                        }
                    });
                    
                    // Si no hay art√≠culos
                    if (totalAmount === 0) {
                        doc.text('No se especificaron art√≠culos', 20, yPos);
                        yPos += 10;
                    }
                    
                    doc.line(20, yPos, 190, yPos);
                    yPos += 15;
                    
                    // Total
                    doc.setFontSize(14);
                    doc.setFont(undefined, 'bold');
                    doc.text('TOTAL A PAGAR:', 120, yPos);
                    doc.text(total, 160, yPos);
                    yPos += 15;
                    
                    // Informaci√≥n adicional
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    doc.text(`M√©todo de pago: ${paymentMethod}`, 20, yPos);
                    yPos += 8;
                    
                    // Garant√≠a
                    const warrantyDays = getWarrantyDays();
                    if (warrantyDays > 0) {
                        const warrantyText = warrantyDays === 1 ? '1 d√≠a' : 
                                            warrantyDays === 30 ? '30 d√≠as' :
                                            warrantyDays === 60 ? '60 d√≠as' :
                                            warrantyDays === 90 ? '90 d√≠as' :
                                            warrantyDays === 180 ? '6 meses' :
                                            warrantyDays === 365 ? '1 a√±o' :
                                            `${warrantyDays} d√≠as`;
                        
                        doc.text(`Garant√≠a: ${warrantyText} contra defectos de fabricaci√≥n`, 20, yPos);
                        yPos += 6;
                        doc.setFontSize(8);
                        doc.text('* No cubre equipos golpeados o h√∫medos.', 20, yPos);
                        doc.setFontSize(10);
                        yPos += 10;
                    }
                    
                    // Notas
                    if (notes && notes !== 'Sin notas adicionales' && notes.trim() !== '') {
                        doc.text('Notas:', 20, yPos);
                        yPos += 6;
                        const shortNotes = notes.length > 100 ? notes.substring(0, 97) + '...' : notes;
                        doc.text(shortNotes, 25, yPos);
                        yPos += 10;
                    }
                    
                    // L√≠nea final
                    doc.line(20, yPos, 190, yPos);
                    yPos += 15;
                    
                    // Firmas
                    doc.setFontSize(8);
                    doc.text('________________________', 20, yPos);
                    doc.text('Firma del cliente', 20, yPos + 6);
                    
                    doc.text('________________________', 120, yPos);
                    doc.text('Firma del vendedor', 120, yPos + 6);
                    
                    yPos += 20;
                    
                    // Pie de p√°gina
                    doc.setFontSize(7);
                    doc.text('Comprobante electr√≥nico ‚Ä¢ Import SCZ ‚Ä¢ Santa Cruz, Bolivia', 20, yPos);
                    doc.text('Centro Comercial Ca√±oto #k1 ‚Ä¢ Tel: 75589308', 20, yPos + 4);
                    
                    // Guardar PDF
                    const fileName = `Nota_${clientName.replace(/\s+/g, '_').substring(0, 15)}_${date.replace(/\//g, '-')}.pdf`;
                    doc.save(fileName);
                    
                    // Actualizar estado
                    pdfStatus.textContent = '‚úÖ PDF generado: ' + fileName;
                    pdfStatus.style.background = 'rgba(76, 175, 80, 0.1)';
                    pdfStatus.style.color = '#4caf50';
                    
                    // Cambiar icono del bot√≥n
                    document.getElementById('pdfIcon').textContent = '‚úÖ';
                    setTimeout(() => {
                        document.getElementById('pdfIcon').textContent = 'üìÑ';
                    }, 2000);
                    
                } catch (error) {
                    console.error('Error generando PDF:', error);
                    const pdfStatus = document.getElementById('pdfStatus');
                    pdfStatus.style.display = 'block';
                    pdfStatus.textContent = '‚ùå Error generando PDF: ' + error.message;
                    pdfStatus.style.background = 'rgba(255, 87, 87, 0.1)';
                    pdfStatus.style.color = '#ff5757';
                    alert('Error al generar PDF: ' + error.message);
                }
            }
            
            // Actualizar vista previa completa
            function updatePreview() {
                // Actualizar informaci√≥n del cliente
                const clientName = document.getElementById('clientName').value || 'Nombre del Cliente';
                const clientPhone = document.getElementById('clientPhone').value || 'No especificado';
                const notes = document.getElementById('notes').value || 'Sin notas adicionales';
                
                document.getElementById('previewClientName').textContent = clientName;
                document.getElementById('previewClientPhone').textContent = 'Tel: ' + clientPhone;
                document.getElementById('previewNotes').textContent = notes;
                
                // Habilitar/deshabilitar bot√≥n WhatsApp
                const whatsappBtn = document.getElementById('sendWhatsApp');
                if (clientPhone.length >= 8) {
                    whatsappBtn.disabled = false;
                    whatsappBtn.title = 'Enviar factura al n√∫mero: ' + clientPhone;
                } else {
                    whatsappBtn.disabled = true;
                    whatsappBtn.title = 'Ingrese un n√∫mero de tel√©fono v√°lido';
                }
                
                // Actualizar m√©todo de pago
                const paymentMethod = paymentMethodInput.value;
                if (paymentMethod === 'efectivo') {
                    document.getElementById('previewPaymentMethod').textContent = 'M√©todo de Pago: Efectivo';
                    document.getElementById('previewPaymentDetails').textContent = 'Pago realizado en efectivo al momento de la entrega';
                    document.getElementById('previewQrSection').style.display = 'none';
                } else {
                    document.getElementById('previewPaymentMethod').textContent = 'M√©todo de Pago: QR/Pago M√≥vil';
                    document.getElementById('previewPaymentDetails').textContent = 'Pago realizado mediante c√≥digo QR o transferencia m√≥vil';
                    document.getElementById('previewQrSection').style.display = 'block';
                }
                
                // Actualizar garant√≠a con texto corregido
                const warrantyDays = getWarrantyDays();
                const warrantyPreview = document.getElementById('warrantyPreview');
                if (warrantyDays > 0) {
                    warrantyPreview.style.display = 'block';
                    const warrantyText = warrantyDays === 1 ? '1 d√≠a' : 
                                        warrantyDays === 30 ? '30 d√≠as' :
                                        warrantyDays === 60 ? '60 d√≠as' :
                                        warrantyDays === 90 ? '90 d√≠as' :
                                        warrantyDays === 180 ? '6 meses' :
                                        warrantyDays === 365 ? '1 a√±o' :
                                        `${warrantyDays} d√≠as`;
                    
                    warrantyPreview.innerHTML = `
                        <div class="warranty-text">
                            <strong>Garant√≠a:</strong> Este producto cuenta con garant√≠a de ${warrantyText} contra defectos de fabricaci√≥n. No cubre equipos golpeados o h√∫medos.
                        </div>
                    `;
                } else {
                    warrantyPreview.style.display = 'none';
                }
                
                // Actualizar items en vista previa
                const itemRows = document.querySelectorAll('#itemsBody tr');
                const previewItems = document.getElementById('previewItems');
                previewItems.innerHTML = '';
                
                let total = 0;
                
                itemRows.forEach(row => {
                    const descInput = row.querySelector('.item-desc');
                    const totalInput = row.querySelector('.item-total-input');
                    
                    const desc = descInput.value || 'Art√≠culo sin descripci√≥n';
                    const itemTotal = parseFloat(totalInput.value) || 0;
                    
                    if (desc || itemTotal > 0) {
                        const saleItem = document.createElement('div');
                        saleItem.className = 'sale-item';
                        saleItem.innerHTML = `
                            <div class="item-info">
                                <div class="item-desc">${desc}</div>
                            </div>
                            <div class="item-total-preview">${itemTotal.toFixed(2)} Bs.</div>
                        `;
                        previewItems.appendChild(saleItem);
                        total += itemTotal;
                    }
                });
                
                // Actualizar total
                document.getElementById('previewTotal').textContent = total.toFixed(2) + ' Bs.';
            }
            
            // Generar factura PDF
            document.getElementById('generateInvoice').addEventListener('click', generatePDF);
            
            // Enviar por WhatsApp - MENSAJE SIMPLIFICADO
            document.getElementById('sendWhatsApp').addEventListener('click', function() {
                const phone = document.getElementById('clientPhone').value;
                const clientName = document.getElementById('clientName').value || 'Cliente';
                
                if (!phone || phone.length < 8) {
                    alert('‚ùå Ingrese un n√∫mero de tel√©fono v√°lido para enviar por WhatsApp');
                    return;
                }
                
                // Formatear n√∫mero para WhatsApp (eliminar espacios, +, etc)
                const cleanPhone = phone.replace(/\D/g, '');
                
                // Obtener descripci√≥n de los art√≠culos
                let articulosDesc = '';
                const itemRows = document.querySelectorAll('#itemsBody tr');
                itemRows.forEach(row => {
                    const descInput = row.querySelector('.item-desc');
                    const desc = descInput.value;
                    if (desc && desc.trim() !== '') {
                        if (articulosDesc !== '') articulosDesc += ', ';
                        articulosDesc += desc;
                    }
                });
                
                // Limitar la descripci√≥n a 100 caracteres
                if (articulosDesc.length > 100) {
                    articulosDesc = articulosDesc.substring(0, 97) + '...';
                }
                
                // Crear mensaje SIMPLIFICADO para WhatsApp
                const message = encodeURIComponent(
                    `Hola: ${clientName}, te enviamos el comprobante por tu compra de ${articulosDesc || 'productos'}.`
                );
                
                // Crear enlace de WhatsApp
                const whatsappLink = `https://wa.me/${cleanPhone}?text=${message}`;
                
                // Primero generar el PDF
                generatePDF();
                
                // Luego abrir WhatsApp despu√©s de un breve delay
                setTimeout(() => {
                    window.open(whatsappLink, '_blank');
                    
                    // Mostrar confirmaci√≥n simple
                    alert(`üì± Mensaje enviado a ${clientName}`);
                }, 1000);
            });
            
            // Restablecer formulario
            document.getElementById('resetForm').addEventListener('click', function() {
                if (confirm('¬øEst√° seguro de que desea restablecer el formulario? Se perder√°n todos los datos.')) {
                    document.getElementById('invoiceForm').reset();
                    
                    // Restablecer items (solo 1 fila)
                    itemsBody.innerHTML = `
                        <tr>
                            <td><input type="text" class="item-desc" placeholder="Descripci√≥n del art√≠culo"></td>
                            <td><input type="number" class="item-total-input" placeholder="0.00" step="0.01"></td>
                        </tr>
                    `;
                    
                    // Restablecer m√©todo de pago
                    paymentOptions.forEach(opt => opt.classList.remove('selected'));
                    document.querySelector('.payment-option.cash').classList.add('selected');
                    paymentMethodInput.value = 'efectivo';
                    qrContainer.style.display = 'none';
                    
                    // Restablecer garant√≠a
                    warrantySelect.value = '30';
                    customWarrantyDiv.style.display = 'none';
                    
                    // Ocultar estado PDF
                    document.getElementById('pdfStatus').style.display = 'none';
                    
                    // Deshabilitar WhatsApp
                    document.getElementById('sendWhatsApp').disabled = true;
                    
                    updatePreview();
                }
            });
            
            // Agregar event listeners a los inputs iniciales
            const formInputs = document.querySelectorAll('#invoiceForm input, #invoiceForm textarea, #invoiceForm select');
            formInputs.forEach(input => {
                input.addEventListener('input', updatePreview);
                input.addEventListener('change', updatePreview);
            });
            
            const initialItemInputs = document.querySelectorAll('#itemsBody input');
            initialItemInputs.forEach(input => {
                input.addEventListener('input', updatePreview);
            });
            
            // Inicializar vista previa
            updateDateTime();
            updatePreview();
        });
    </script>
</body>
</html>
